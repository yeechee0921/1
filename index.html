import React, { useState, useEffect } from 'react';
import { Calendar, Clock, Users, Car, MapPin, Phone, Plus, Search, FileText, Download, MessageCircle } from 'lucide-react';

const TransportManagementSystem = () => {
  const [currentDate, setCurrentDate] = useState(new Date());
  const [selectedDay, setSelectedDay] = useState('monday');
  const [viewMode, setViewMode] = useState('daily'); // daily, weekly, students, reports, whatsapp
  const [searchTerm, setSearchTerm] = useState('');

  // 联系人数据库
  const contacts = {
    morningUncle: { name: '早上班Uncle', phone: '60123456789' }, // 替换为实际电话
    afternoonUncle: { name: '下午班Uncle', phone: '60123456788' }, // 替换为实际电话
    center: { name: '补习中心', phone: '60123456787' } // 替换为实际电话
  };

  // 学生数据库
  const studentsDatabase = {
    // Y级学生
    'Y1': [
      { name: '郑俐洁', english: 'Zheng Li Jie', school: 'A校', phone: '', address: '' },
      { name: '俐洁', english: 'Li Jie', school: 'A校', phone: '', address: '45 Lorong Batu Nilam 35B, BBT' },
      { name: 'Emily', english: 'Emily', school: 'A校', phone: '', address: '' },
      { name: 'Dexter', english: 'Dexter', school: '', phone: '', address: '14 jalan batu arang' }
    ],
    'Y2': [
      { name: '陈柏祥', english: 'Chen Bo Xiang', school: 'A校', phone: '', address: '' },
      { name: '陈家权', english: 'Chen Jia Quan', school: 'A校', phone: '', address: '' },
      { name: '王文泰', english: 'Wang Wen Tai', school: 'A校', phone: '012-5798976 (爸)', address: '' },
      { name: '洪惟哲', english: 'Hong Wei Zhe', school: 'A校', phone: '016-3220173 (妈)', address: '8, Jalan Jenaris 2, Bandar Botanic' },
      { name: '潘欣莹', english: 'Pan Xin Ying', school: 'A校', phone: '019-3377883 (妈)', address: '27, Jalan Jelai(Toyota厂对面)', aunty: true },
      { name: '捷能', english: 'Jie Neng', school: 'A校', phone: '', address: '35, lorong mesra 2,Taman Chi liung', aunty: true },
      { name: '黄宇哲', english: 'Huang Yu Zhe', school: '', phone: '', address: '8, Jalan Jenaris 2, Bandar Botanic' },
      { name: 'li wen', english: 'Li Wen', school: '', phone: '', address: '' },
      { name: '俐雯', english: 'Li Wen', school: 'A校', phone: '', address: '45 Lorong Batu Nilam 35B, BBT' }
    ],
    'Y3': [
      { name: '陈敏姿', english: 'Chen Min Zhi', school: '青年', phone: '', address: '70, Jalan Pandamaran Jaya 18' },
      { name: '敏姿', english: 'Min Zi', school: '青年', phone: '', address: '70, Jalan Pandamaran Jaya 18' },
      { name: '徐妤彤', english: 'Xu Yu Tong', school: 'A校', phone: '011-10049498 (妈)', address: '' },
      { name: '林韦颖', english: 'Lin Wei Ying', school: 'A校', phone: '014-3490602 (爸)', address: '' },
      { name: '王奕皓', english: 'Wang Yi Hao', school: 'A校', phone: '', address: 'No 71 jalan selasih off telok gadong klang selangor 41100' },
      { name: '王桓浩', english: 'Wang Huan Hao', school: 'A校', phone: '', address: '17 Lorong Kemenyan 1B, Persiaran Raja Muda Musa', aunty: true },
      { name: '桓浩', english: 'Huan Hao', school: 'A校', phone: '', address: '17 Lorong Kemenyan 1B, Persiaran Raja Muda Musa' },
      { name: '潘珮莹', english: 'Pan Pei Ying', school: 'A校', phone: '019-3377883 (妈)', address: '27, Jalan Jelai(Toyota厂对面)', aunty: true },
      { name: '叶子翔', english: 'Ye Zi Xiang', school: '', phone: '', address: '43 Lorong Batu Nilam 33C, BBT2' },
      { name: '子翔', english: 'Zi Xiang', school: '', phone: '', address: '43 Lorong Batu Nilam 33C, BBT2' },
      { name: '郭勇尊', english: 'Guo Yong Zun', school: 'A校', phone: '', address: '' },
      { name: '慧婷', english: 'Hui Ting', school: '', phone: '', address: '26 lorong permai 3E/KS5' }
    ],
    'Y4': [
      { name: '郑昊祥', english: 'Zheng Hao Xiang', school: 'A校', phone: '012-3548293 (妈)', address: '45 Lorong Batu Nilam 35B, BBT' },
      { name: '郑昊翔', english: 'Zheng Hao Xiang', school: 'A校', phone: '012-3548293 (妈)', address: '45 Lorong Batu Nilam 35B, BBT' },
      { name: '杨恺馨', english: 'Yang Kai Xin', school: 'A校', phone: '012-6652355(妈)', address: '' },
      { name: '林浩宇', english: 'Lin Hao Yu', school: 'A校', phone: '', address: '' },
      { name: '黄桔威', english: 'Huang Jie Wei', school: 'A校', phone: '019-2148655 (爸)', address: '' },
      { name: '孙湘倪', english: 'Sun Xiang Ni', school: 'A校', phone: '012-9431884 (妈)', address: '898, Jalan Sekinchan新村', aunty: true },
      { name: '潘友盛', english: 'Dylan', school: 'A校', phone: '019-3377883 (妈)', address: '' },
      { name: '陈紫渲', english: 'Chen Zi Xuan', school: 'A校', phone: '', address: '' },
      { name: '俐恩', english: 'Li En', school: 'A校', phone: '', address: '45 Lorong Batu Nilam 35B, BBT' },
      { name: '郭勇耀', english: 'Guo Yong Yao', school: 'A校', phone: '', address: '' }
    ],
    'Y5': [
      { name: '陈欣慧', english: 'Chen Xin Hui', school: 'A校', phone: '011-11980200 (妈)', address: '' },
      { name: '林诗颖', english: 'Lin Shi Ying', school: 'A校', phone: '014-3490602 (爸)', address: '861, Jalan Merbau, Pandamaran 新村' },
      { name: '诗颖', english: 'Shi Ying', school: 'A校', phone: '014-3490602 (爸)', address: '861, Jalan Merbau, Pandamaran 新村' },
      { name: '韦颖', english: 'Wei Ying', school: 'A校', phone: '014-3490602 (爸)', address: '861, Jalan Merbau, Pandamaran 新村' },
      { name: '陈芯茹', english: 'Chen Xin Ru', school: 'A校', phone: '016-2978928(妈)', address: '' },
      { name: '达韦娜', english: 'Darswinah', school: 'A校', phone: '', address: '' }
    ],
    'Y6': [
      { name: '李隽颉', english: 'Li Jun Jie', school: 'A校', phone: '', address: '' },
      { name: '郭莹莹', english: 'Guo Ying Ying', school: 'A校', phone: '', address: '' },
      { name: '刘丽煊', english: 'Liu Li Xuan', school: '青年', phone: '019-2485553 (妈)', address: '' },
      { name: '林宗毅', english: 'Lin Zong Yi', school: 'B校', phone: '019-4314917 (爸)', address: 'PT 24429, Jalan Aman off Kampung Idaman' },
      { name: 'Samicha', english: 'Samicha', school: 'B校', phone: '', address: '39, Jalan Pandamaran Jaya 101J/KS5' },
      { name: '莎米佳', english: 'Samicha', school: 'B校', phone: '', address: '39, Jalan Pandamaran Jaya 101J/KS5, Taman Ehsan Jaya' },
      { name: '叶哲炜', english: 'Ye Zhe Wei', school: '', phone: '018-2408331', address: '43 Lorong Batu Nilam 33C, BBT2' },
      { name: '哲炜', english: 'Zhe Wei', school: 'A校', phone: '018-2408331', address: '43 Lorong Batu Nilam 33C, BBT2' },
      { name: '叶进杰', english: 'Ye Jin Jie', school: '', phone: '012-6713386', address: '9, Lorong Batu Nilam 15D, BBT' },
      { name: '沈文琪', english: 'Shen Wen Qi', school: '', phone: '012-2055304', address: '97, Solok Pendamar Indah 5A(Petronas后面)' },
      { name: '蔡立杨', english: 'Cai Li Yang', school: 'B校', phone: '013-3888711', address: '10, Lorong Permai 6A, Taman Kota Pendamar' },
      { name: 'Dylan', english: 'Dylan', school: '', phone: '', address: '14 jalan batu arang' }
    ],
    // F级学生
    'F1': [
      { name: '翊恺', english: 'Yi Kai', school: '', phone: '', address: '' },
      { name: '俐玲', english: 'Li Ling', school: '', phone: '', address: '' },
      { name: '钰璇', english: 'Yu Xuan', school: '', phone: '', address: '' },
      { name: '嘉恩', english: 'Jia En', school: '', phone: '', address: '' },
      { name: '刘裔琳', english: 'Lau Elaine', school: '', phone: '', address: 'no 43 jalan sambau 15b,taman bayu perdana,41200 klang,selangor' },
      { name: '谢俊烽', english: 'Xie Jun Feng', school: 'Ampuan', phone: '016-2032379 (爸)', address: '' },
      { name: '谢清雯', english: 'Xie Qing Wen', school: 'Ampuan', phone: '016-2032379 (爸)', address: '' },
      { name: '清雯', english: 'Qing Wen', school: 'Ampuan', phone: '', address: '' },
      { name: '俊烽', english: 'Jun Feng', school: 'Ampuan', phone: '', address: '' }
    ],
    'F2': [
      { name: '惠璇', english: 'Hui Xuan', school: '', phone: '', address: '' },
      { name: '珮仪', english: 'Pei Yi', school: '', phone: '', address: '' },
      { name: 'Doreen', english: 'Doreen', school: '', phone: '', address: '' },
      { name: 'jun xuan', english: 'Jun Xuan', school: '', phone: '', address: '' },
      { name: '谢俊翔', english: 'Xie Jun Xiang', school: '', phone: '', address: '' }
    ],
    'F3': [
      { name: '维思', english: 'Wei Si', school: '', phone: '', address: '6A lorong permai 3E/ks5, jalan pandamar villa, pandamaran 42000 pelabuhan klang' },
      { name: '颜宇君', english: 'Yan Yu Jun', school: 'Ampuan', phone: '', address: '8, Lorong Batu Nilam 30B, BBT2' }
    ],
    'F4': [
      { name: '巧莹', english: 'Qiao Ying', school: '', phone: '', address: '24, Jalan Pandamaran Jaya 91A' },
      { name: '周旻晴', english: 'Zhou Min Qing', school: '', phone: '019-8069337', address: '5, Jalan Mawar 2/ks4 Taman Raja Uda' },
      { name: '刘思恩', english: 'Liu Si En', school: '', phone: '', address: '10, Lorong Batu Nilam14D, BBT1' },
      { name: '林凯伦', english: 'Lin Kai Lun', school: '', phone: '012-3431220 / 0182996233', address: '62, Jalan Cucur Atap (靠近青年学校）' },
      { name: 'min cheng', english: 'Min Cheng', school: '', phone: '', address: '' }
    ],
    'F5': [
      { name: '祥佑', english: 'Xiang You', school: '', phone: '016-3464816', address: '7 jalan pendamar indah 1, taman pendamar indah' },
      { name: '沺鸿', english: 'Tian Hong', school: '', phone: '', address: '' }
    ],
    // Others
    'Teachers': [
      { name: '华老师', english: 'Teacher Hua', school: '', phone: '', address: '' },
      { name: '宇老师', english: 'Teacher Yu', school: '', phone: '', address: '' }
    ],
    'Others': [
      { name: '慧雯', english: 'Hui Wen', school: '', phone: '', address: '15 Lorong Aur(青年学校旁）' }
    ]
  };

  // 每日载送安排
  const weeklySchedule = {
    monday: {
      morning: [
        { time: '9:00AM-9:30AM', type: 'COME', students: ['Teacher Hua', 'Teacher Yu'] },
        { time: '9:30AM', type: 'BACK', students: ['F2 惠璇', 'F2 珮仪', 'F2 Doreen', 'F1 刘裔琳'] },
        { time: '10:00AM-10:30AM', type: 'COME', students: ['慧雯'] },
        { time: '11:00PM', type: 'BACK', students: ['F1 翊恺', 'F1 俐玲', 'F1 钰璇', 'F1 嘉恩'] }
      ],
      afternoon: [
        { 
          time: '4:30PM-5:30PM', 
          type: '载来', 
          students: [
            'Y6 叶进杰 (012-6713386)',
            'Y6 沈文琪 (012-2055304)',
            'Y6 蔡立杨 (013-3888711)',
            'Y6 叶哲炜 (018-2408331)'
          ]
        },
        { 
          time: '5:30PM', 
          type: '载回', 
          students: [
            'Y3 陈敏姿',
            'Y4 郑昊翔',
            'Y4俐恩 Y1俐洁 Y2俐雯',
            'Y2 黄宇哲',
            'F4 巧莹',
            'Y3 叶子翔',
            'F5 祥佑'
          ], 
          auntyStudents: [
            'Y4 孙湘倪',
            'Y3 王桓浩'
          ]
        },
        { 
          time: '6:30PM', 
          type: '去AMPUAN载来中心', 
          students: ['F1 谢清雯', 'F1 谢俊烽', 'F2 谢俊翔'] 
        },
        { 
          time: '7:00PM', 
          type: '载回(Pandamaran->Bukit Tinggi->港口)', 
          students: [
            'Y6 莎米佳',
            'Y6 沈文琪',
            'Y6 林宗毅 Y4 林雨彤',
            'Y5 诗颖 韦颖',
            'Y6 叶哲炜',
            'F3 颜宇君'
          ]
        }
      ]
    },
    tuesday: {
      morning: [
        { time: '9:00AM-9:30AM', type: 'COME', students: ['Teacher Hua', 'Teacher Yu'] },
        { time: '9:30AM', type: 'BACK', students: ['F2 Doreen', 'F1 翊恺', 'F1 俐玲', 'F1 钰璇'] }
      ],
      afternoon: [
        { 
          time: '4:30PM-5:30PM', 
          type: '载来', 
          students: [
            'Y6 叶进杰 (012-6713386)',
            'Y6 沈文琪 (012-2055304)',
            'F4 周旻晴 (019-8069337)',
            'F4 林凯伦 (012-3431220)',
            'Y6 蔡立杨 (013-3888711)',
            'Y6 叶哲炜 (018-2408331)'
          ]
        },
        { 
          time: '5:30PM', 
          type: '载回', 
          students: [
            'Y3 陈敏姿',
            'Y4 郑昊翔',
            'Y4俐恩 Y1俐洁 Y2俐雯',
            'Y2 黄宇哲',
            'Y3 叶子翔'
          ], 
          auntyStudents: [
            'Y4 孙湘倪',
            'Y3 潘珮莹',
            'Y3 王桓浩'
          ]
        },
        { 
          time: '6:30PM', 
          type: '去AMPUAN载来中心', 
          students: ['F1 谢清雯', 'F1 谢俊烽'] 
        },
        { 
          time: '7:00PM', 
          type: '载回(Pandamaran->Bukit Tinggi->港口)', 
          students: [
            'Y6 莎米佳',
            'Y6 沈文琪',
            'Y6 林宗毅 Y4 林雨彤',
            'Y5 诗颖 韦颖',
            'Y6 叶哲炜',
            'F4 巧莹',
            'F4 周旻晴',
            'F4 刘思恩',
            'F4 林凯伦',
            'F3 颜宇君'
          ]
        }
      ]
    },
    wednesday: {
      morning: [
        { time: '9:00AM-9:30AM', type: 'COME', students: ['Teacher Yu'] },
        { time: '9:30AM', type: 'BACK', students: ['F2 惠璇', 'F2 珮仪', 'F1 翊恺', 'F1 俐玲', 'F2 jun xuan', 'F1 刘裔琳'] },
        { time: '10:00AM-10:30AM', type: 'COME', students: ['慧雯'] },
        { time: '2:00PM-2:30PM', type: 'COME', students: ['Y2 li wen Y4 li en'] },
        { time: '2:50PM', type: 'TAKE FROM PAN A TO CENTER', students: [] },
        { time: '3:00PM', type: 'TAKE FROM PAN B TO CENTER', students: ['Y6 Samicha'] },
        { time: '3:30PM-4:00PM', type: 'COME', students: ['Y3 子翔', 'F4 min cheng', 'Y4 li en'] }
      ],
      afternoon: [
        { 
          time: '4:30PM-5:30PM', 
          type: '载来', 
          students: [
            'Y6 叶进杰 (012-6713386)',
            'Y6 叶哲炜 (018-2408331)',
            'Y6 蔡立杨 (013-3888711)'
          ]
        },
        { 
          time: '5:30PM', 
          type: '载回', 
          students: [
            'Y3 陈敏姿',
            'Y4 郑昊翔',
            'Y4俐恩 Y1俐洁 Y2俐雯',
            'Y2 黄宇哲',
            'Y3 叶子翔'
          ], 
          auntyStudents: [
            'Y4 孙湘倪',
            'Y3 潘珮莹',
            'Y3 王桓浩'
          ]
        },
        { 
          time: '6:30PM', 
          type: '去AMPUAN载来中心', 
          students: ['F1 谢清雯', 'F1 谢俊烽', 'F2 谢俊翔'] 
        },
        { 
          time: '7:00PM', 
          type: '载回(Pandamaran->Bukit Tinggi->港口)', 
          students: [
            'Y6 莎米佳',
            'Y6 林宗毅 Y4 林雨彤',
            'Y5 诗颖 韦颖',
            'Y6 叶哲炜',
            'F4 周旻晴',
            'F3 颜宇君 华老师 宇老师'
          ]
        }
      ]
    },
    thursday: {
      morning: [
        { time: '9:00AM-9:30AM', type: 'COME', students: ['Teacher Yu'] },
        { time: '9:30AM', type: 'BACK', students: ['F2 惠璇', 'F2 珮仪', 'F1 翊恺', 'F1 俐玲', 'F1 钰璇'] },
        { time: '10:00AM-10:30AM', type: 'COME', students: ['慧雯'] },
        { time: '2:00PM-2:30PM', type: 'COME', students: ['Y2 li wen Y4 li en'] },
        { time: '2:45PM-4:00PM', type: 'COME', students: ['Y3 子翔', 'F4 巧莹', 'F4 旻晴', 'F4 刘思恩', 'F4 凯伦'] },
        { time: '3:30PM', type: 'TAKE FROM SCHOOL TO CENTER', students: ['Y3 Chen Min Zhi (青年)', 'Y6 Liu Li Xuan (青年)'] }
      ],
      afternoon: [
        { 
          time: '4:30PM', 
          type: '从A校载来补习', 
          students: [
            'Y4 林浩宇',
            'Y4 黄桔威',
            'Y3 王桓浩',
            'Y4 潘友盛',
            'Y5 林诗颖',
            'Y5 达韦娜',
            'Y6 叶哲炜',
            'Y4 郭勇耀'
          ]
        },
        { 
          time: '4:30PM-5:30PM', 
          type: '载来', 
          students: [
            'Y6 叶进杰 (012-6713386)',
            'Y6 沈文琪 (012-2055304)',
            'F5 祥佑 (016-3464816)',
            'Y6 蔡立杨 (013-3888711)'
          ]
        },
        { 
          time: '5:30PM', 
          type: '载回', 
          students: [
            'Y3 陈敏姿',
            'Y4 郑昊翔',
            'Y4俐恩 Y1俐洁 Y2俐雯',
            'Y2 黄宇哲',
            'F3 维思',
            'Y3 叶子翔'
          ], 
          auntyStudents: [
            'Y4 孙湘倪',
            'Y3 潘珮莹',
            'Y3 王桓浩'
          ]
        },
        { 
          time: '6:30PM', 
          type: '去AMPUAN载来中心', 
          students: ['F1 谢清雯', 'F1 谢俊烽'] 
        },
        { 
          time: '7:00PM', 
          type: '载回(Pandamaran->Bukit Tinggi->港口)', 
          students: [
            '华老师 宇老师',
            'Y6 莎米佳',
            'Y6 沈文琪',
            'Y6 林宗毅 Y4 林雨彤',
            'Y5 诗颖 韦颖',
            'Y6 叶哲炜',
            'F5 祥佑',
            'F4 巧莹',
            'F4 周旻晴',
            'F4 刘思恩',
            'F4 林凯伦'
          ]
        }
      ]
    },
    friday: {
      morning: [
        { time: '9:00AM-9:30AM', type: 'COME', students: ['Teacher Yu', 'Teacher Hua'] },
        { time: '9:30AM', type: 'BACK', students: ['F2 惠璇', 'F2 jun xuan', 'F1 刘裔琳'] },
        { time: '10:00AM-10:30AM', type: 'COME', students: ['慧雯'] },
        { time: '11:00AM', type: 'BACK', students: ['F2 珮仪', 'F1 翊恺', 'F1 俐玲', 'F1 钰璇', 'F1 嘉恩'] },
        { time: '2:00PM-2:30PM', type: 'COME', students: ['F3 维思', 'Y2 li wen'] },
        { time: '2:50PM', type: 'TAKE FROM PAN A TO CENTER', students: [] },
        { time: '3:20PM-4:00PM', type: 'COME', students: ['Y3 子翔', 'F5 沺鸿', 'Y4 li en'] },
        { time: '3:30PM', type: 'TAKE FROM SCHOOL TO CENTER', students: ['Y6 Liu Li Xuan (青年)'] },
        { time: '4:00PM', type: 'BACK', students: ['F3 维思'] }
      ],
      afternoon: [
        { 
          time: '4:30PM-5:30PM', 
          type: '载来', 
          students: [
            'Y6 叶进杰 (012-6713386)',
            'Y6 沈文琪 (012-2055304)',
            'Y6 叶哲炜 (018-2408331)',
            'Y6 蔡立杨 (013-3888711)'
          ]
        },
        { 
          time: '5:30PM', 
          type: '载回', 
          students: [
            'Y3 陈敏姿',
            'Y4 郑昊翔',
            'Y4俐恩 Y1俐洁 Y2俐雯',
            'Y2 黄宇哲',
            'Y3 叶子翔',
            'Y2 捷能',
            'Y3 子翔',
            'F3 颜宇君'
          ], 
          auntyStudents: [
            'Y4 孙湘倪',
            'Y3 潘珮莹',
            'Y3 王桓浩'
          ]
        },
        { 
          time: '6:30PM', 
          type: '去AMPUAN载来中心', 
          students: ['F2 谢俊翔', 'F1 谢清雯', 'F1 谢俊烽'] 
        },
        { 
          time: '7:00PM', 
          type: '载回(Pandamaran->Bukit Tinggi->港口)', 
          students: [
            '华老师 宇老师',
            'Y6 莎米佳',
            'Y6 沈文琪',
            'Y6 林宗毅 Y4 林雨彤',
            'Y5 诗颖 韦颖',
            'Y6 叶哲炜'
          ]
        }
      ]
    },
    saturday: {
      morning: [
        { 
          time: '9:45AM-10:00AM', 
          type: 'COME', 
          students: ['Y3 子翔'] 
        },
        { 
          time: '10:30AM-11:00AM', 
          type: 'COME', 
          students: ['Y3 敏姿'] 
        },
        { 
          time: '12:00PM-12:30PM', 
          type: 'COME', 
          students: [
            'Y6 哲炜',
            'Y6 莎米佳', 
            'Y6 Dylan Y1 Dexter'
          ] 
        },
        { 
          time: '12:30PM', 
          type: 'BACK', 
          students: [
            'Y3 子翔',
            'Y3 敏姿'
          ] 
        },
        { 
          time: '2:00PM', 
          type: 'BACK', 
          students: [
            'Y6 哲炜',
            'Y6 莎米佳',
            'Y6 宗毅 雨彤',
            '韦颖 诗颖 Roggers',
            '桓浩',
            'Y6 Dylan Y1 Dexter'
          ] 
        }
      ],
      afternoon: []
    }
  };

  const daysOfWeek = [
    { key: 'monday', label: '星期一', english: 'Monday' },
    { key: 'tuesday', label: '星期二', english: 'Tuesday' },
    { key: 'wednesday', label: '星期三', english: 'Wednesday' },
    { key: 'thursday', label: '星期四', english: 'Thursday' },
    { key: 'friday', label: '星期五', english: 'Friday' },
    { key: 'saturday', label: '星期六', english: 'Saturday' }
  ];

  // 获取学生详细信息
  const getStudentInfo = (studentName) => {
    for (const grade in studentsDatabase) {
      const student = studentsDatabase[grade].find(s => 
        s.name === studentName || s.english === studentName || studentName.includes(s.name) ||
        s.name.includes(studentName) || s.english.includes(studentName)
      );
      if (student) {
        return { ...student, grade };
      }
    }
    return null;
  };

  // 搜索学生
  const searchStudents = (term) => {
    const results = [];
    for (const grade in studentsDatabase) {
      studentsDatabase[grade].forEach(student => {
        if (student.name.toLowerCase().includes(term.toLowerCase()) || 
            student.english.toLowerCase().includes(term.toLowerCase())) {
          results.push({ ...student, grade });
        }
      });
    }
    return results;
  };

  // 获取今天是星期几
  const getTodayKey = () => {
    const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
    return days[currentDate.getDay()];
  };

  // 解析学生信息 (从显示文本中提取学生名字和联系信息)
  const parseStudentInfo = (studentText) => {
    // 移除括号内的地址和电话信息，只保留学生姓名
    const cleanName = studentText.replace(/\([^)]*\)/g, '').trim();
    const phoneMatch = studentText.match(/\(([0-9-]+[^)]*)\)/);
    const phone = phoneMatch ? phoneMatch[1] : '';
    
    return {
      name: cleanName,
      phone: phone
    };
  };

  // 生成早上班Uncle英文通知
  const generateMorningUncleMessage = (dayKey) => {
    const schedule = weeklySchedule[dayKey];
    if (!schedule || !schedule.morning) return '';

    const today = new Date();
    const dayName = daysOfWeek.find(d => d.key === dayKey)?.english || dayKey;
    const dateStr = today.toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });

    let message = `🚌 MORNING TRANSPORT SCHEDULE\n`;
    message += `📅 ${dayName}, ${dateStr}\n\n`;

    schedule.morning.forEach((session, idx) => {
      message += `⏰ ${session.time} - ${session.type.toUpperCase()}\n`;
      session.students.forEach((student, studentIdx) => {
        const studentInfo = parseStudentInfo(student);
        const info = getStudentInfo(studentInfo.name);
        const englishName = info?.english || studentInfo.name;
        message += `${studentIdx + 1}. ${englishName}\n`;
      });
      message += `\n`;
    });

    message += `✅ Please confirm receipt of this schedule.\n`;
    message += `📱 Contact center if any questions.`;

    return message;
  };

  // 生成下午班Uncle中文通知
  const generateAfternoonUncleMessage = (dayKey) => {
    const schedule = weeklySchedule[dayKey];
    if (!schedule || !schedule.afternoon) return '';

    const today = new Date();
    const dayName = daysOfWeek.find(d => d.key === dayKey)?.label || dayKey;
    const dateStr = today.toLocaleDateString('zh-CN', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });

    let message = `🚌 下午班载送安排\n`;
    message += `📅 ${dayName} ${dateStr}\n\n`;

    schedule.afternoon.forEach((session, idx) => {
      message += `⏰ ${session.time} ${session.type}\n`;
      session.students.forEach((student, studentIdx) => {
        message += `${studentIdx + 1}. ${student}\n`;
      });
      
      if (session.auntyStudents) {
        message += `\n🏠 Aunty载送学生:\n`;
        session.auntyStudents.forEach((student, studentIdx) => {
          message += `${studentIdx + 1}. ${student} (家长载)\n`;
        });
      }
      message += `\n`;
    });

    message += `✅ 请确认收到此安排\n`;
    message += `📱 有问题请联系中心`;

    return message;
  };

  // 生成Aunty载送通知
  const generateAuntyMessage = (dayKey) => {
    const schedule = weeklySchedule[dayKey];
    const auntyStudents = [];
    
    if (schedule) {
      [...(schedule.morning || []), ...(schedule.afternoon || [])].forEach(session => {
        if (session.auntyStudents) {
          session.auntyStudents.forEach(student => {
            const studentInfo = parseStudentInfo(student);
            const info = getStudentInfo(studentInfo.name);
            auntyStudents.push({
              name: student,
              time: session.time,
              type: session.type,
              phone: info?.phone || '',
              address: info?.address || ''
            });
          });
        }
      });
    }

    if (auntyStudents.length === 0) return '';

    const today = new Date();
    const dayName = daysOfWeek.find(d => d.key === dayKey)?.label || dayKey;
    const dateStr = today.toLocaleDateString('zh-CN', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });

    let message = `🏠 家长载送提醒\n`;
    message += `📅 ${dayName} ${dateStr}\n\n`;
    message += `以下学生需要家长自行载送：\n\n`;

    auntyStudents.forEach((student, idx) => {
      message += `${idx + 1}. ${student.name}\n`;
      message += `   时间: ${student.time} ${student.type}\n`;
      if (student.address) {
        message += `   地址: ${student.address}\n`;
      }
      message += `\n`;
    });

    message += `请各位家长准时载送，谢谢配合！\n`;
    message += `📱 如有问题请联系补习中心`;

    return message;
  };

  // 生成WhatsApp链接
  const generateWhatsAppLink = (message, phone = '') => {
    const encodedMessage = encodeURIComponent(message);
    if (phone) {
      return `https://wa.me/${phone}?text=${encodedMessage}`;
    } else {
      return `https://wa.me/?text=${encodedMessage}`;
    }
  };

  // 复制到剪贴板
  const copyToClipboard = async (text) => {
    try {
      await navigator.clipboard.writeText(text);
      alert('消息已复制到剪贴板！');
    } catch (err) {
      // 如果clipboard API不可用，使用备用方法
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      alert('消息已复制到剪贴板！');
    }
  };

  // 渲染每日时间表
  const renderDailySchedule = (dayKey) => {
    const schedule = weeklySchedule[dayKey];
    if (!schedule) return <div className="text-gray-500">今天没有载送安排</div>;

    return (
      <div className="space-y-6">
        {schedule.morning && (
          <div>
            <h3 className="text-lg font-semibold text-blue-700 mb-3 flex items-center gap-2">
              <Clock className="w-5 h-5" />
              上午时间表
            </h3>
            {schedule.morning.map((session, idx) => (
              <div key={idx} className="bg-blue-50 p-4 rounded-lg mb-3">
                <div className="flex items-center gap-2 mb-2">
                  <span className="font-medium text-blue-800">{session.time}</span>
                  <span className="text-sm bg-blue-200 px-2 py-1 rounded">{session.type}</span>
                </div>
                <div className="grid gap-2">
                  {session.students.map((student, studentIdx) => {
                    const studentInfo = parseStudentInfo(student);
                    const info = getStudentInfo(studentInfo.name);
                    return (
                      <div key={studentIdx} className="flex items-center justify-between bg-white p-2 rounded border">
                        <span className="font-medium">{studentIdx + 1}. {student}</span>
                        {info && (
                          <div className="flex items-center gap-2 text-sm text-gray-600">
                            {info.school && <span className="bg-gray-100 px-2 py-1 rounded">{info.school}</span>}
                            {(info.phone || studentInfo.phone) && <Phone className="w-4 h-4" />}
                            {info.address && <MapPin className="w-4 h-4" />}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            ))}
          </div>
        )}

        {schedule.afternoon && (
          <div>
            <h3 className="text-lg font-semibold text-green-700 mb-3 flex items-center gap-2">
              <Clock className="w-5 h-5" />
              下午时间表
            </h3>
            {schedule.afternoon.map((session, idx) => (
              <div key={idx} className="bg-green-50 p-4 rounded-lg mb-3">
                <div className="flex items-center gap-2 mb-2">
                  <span className="font-medium text-green-800">{session.time}</span>
                  <span className="text-sm bg-green-200 px-2 py-1 rounded">{session.type}</span>
                </div>
                <div className="grid gap-2">
                  {session.students.map((student, studentIdx) => {
                    const studentInfo = parseStudentInfo(student);
                    const info = getStudentInfo(studentInfo.name);
                    return (
                      <div key={studentIdx} className="flex items-center justify-between bg-white p-2 rounded border">
                        <span className="font-medium">{studentIdx + 1}. {student}</span>
                        {info && (
                          <div className="flex items-center gap-2 text-sm text-gray-600">
                            {info.school && <span className="bg-gray-100 px-2 py-1 rounded">{info.school}</span>}
                            {(info.phone || studentInfo.phone) && <Phone className="w-4 h-4" />}
                            {info.address && <MapPin className="w-4 h-4" />}
                          </div>
                        )}
                      </div>
                    );
                  })}
                  {session.auntyStudents && (
                    <div className="mt-2 p-2 bg-orange-100 rounded border-l-4 border-orange-400">
                      <h4 className="font-medium text-orange-800 mb-1">Aunty载送学生:</h4>
                      {session.auntyStudents.map((student, studentIdx) => {
                        const studentInfo = parseStudentInfo(student);
                        const info = getStudentInfo(studentInfo.name);
                        return (
                          <div key={studentIdx} className="flex items-center justify-between text-sm">
                            <span>{studentIdx + 1}. {student} (Aunty载)</span>
                            {info && info.address && (
                              <MapPin className="w-4 h-4 text-orange-600" />
                            )}
                          </div>
                        );
                      })}
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    );
  };

  // 渲染学生管理界面
  const renderStudentsView = () => {
    const filteredStudents = searchTerm ? searchStudents(searchTerm) : [];
    
    return (
      <div className="space-y-6">
        <div className="flex items-center gap-4 mb-6">
          <div className="relative flex-1">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
            <input
              type="text"
              placeholder="搜索学生姓名..."
              className="w-full pl-10 pr-4 py-2 border rounded-lg"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
        </div>

        {searchTerm ? (
          <div>
            <h3 className="text-lg font-semibold mb-4">搜索结果 ({filteredStudents.length})</h3>
            <div className="grid gap-4">
              {filteredStudents.map((student, idx) => (
                <div key={idx} className="bg-white p-4 rounded-lg border shadow-sm">
                  <div className="flex justify-between items-start mb-2">
                    <div>
                      <h4 className="font-medium text-lg">{student.grade} {student.name}</h4>
                      <p className="text-gray-600">{student.english}</p>
                    </div>
                    {student.aunty && (
                      <span className="bg-orange-100 text-orange-800 px-2 py-1 rounded text-sm">Aunty载</span>
                    )}
                  </div>
                  {student.school && (
                    <p className="text-sm text-gray-600 mb-1">
                      <span className="font-medium">学校:</span> {student.school}
                    </p>
                  )}
                  {student.phone && (
                    <p className="text-sm text-gray-600 mb-1">
                      <Phone className="inline w-4 h-4 mr-1" />
                      {student.phone}
                    </p>
                  )}
                  {student.address && (
                    <p className="text-sm text-gray-600">
                      <MapPin className="inline w-4 h-4 mr-1" />
                      {student.address}
                    </p>
                  )}
                </div>
              ))}
            </div>
          </div>
        ) : (
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {Object.entries(studentsDatabase).map(([grade, students]) => (
              <div key={grade} className="bg-white p-4 rounded-lg border shadow-sm">
                <h3 className="font-semibold text-lg mb-3 text-blue-700">{grade} 年级 ({students.length}人)</h3>
                <div className="space-y-2">
                  {students.map((student, idx) => (
                    <div key={idx} className="flex justify-between items-center py-1">
                      <span className="text-sm">{student.name}</span>
                      {student.aunty && (
                        <span className="bg-orange-100 text-orange-700 px-2 py-1 rounded text-xs">Aunty</span>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    );
  };

  // 渲染WhatsApp通知界面
  const renderWhatsAppView = () => {
    const morningMessage = generateMorningUncleMessage(selectedDay);
    const afternoonMessage = generateAfternoonUncleMessage(selectedDay);
    const auntyMessage = generateAuntyMessage(selectedDay);

    return (
      <div className="space-y-6">
        <div className="bg-green-50 p-4 rounded-lg mb-6">
          <h2 className="text-xl font-semibold text-green-800 mb-2 flex items-center gap-2">
            <MessageCircle className="w-6 h-6" />
            WhatsApp通知中心
          </h2>
          <p className="text-green-600">选择日期并发送载送安排给相关人员，支持自动格式化和直接发送</p>
        </div>

        {/* 日期选择 */}
        <div className="flex flex-wrap gap-2 mb-6">
          {daysOfWeek.map((day) => {
            const schedule = weeklySchedule[day.key];
            let totalSessions = 0;
            if (schedule) {
              totalSessions += (schedule.morning || []).length + (schedule.afternoon || []).length;
            }
            
            return (
              <button
                key={day.key}
                onClick={() => setSelectedDay(day.key)}
                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                  selectedDay === day.key 
                    ? 'bg-green-600 text-white' 
                    : day.key === getTodayKey()
                    ? 'bg-green-100 text-green-800 border-2 border-green-300'
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                {day.label}
                {totalSessions > 0 && (
                  <span className="ml-1 text-xs bg-blue-500 text-white px-1 rounded">{totalSessions}班</span>
                )}
                {day.key === getTodayKey() && (
                  <span className="ml-1 text-xs bg-green-500 text-white px-1 rounded">今天</span>
                )}
              </button>
            );
          })}
        </div>

        <div className="grid lg:grid-cols-3 gap-6">
          {/* 早上班Uncle通知 */}
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-6">
            <div className="flex items-center gap-2 mb-4">
              <div className="w-3 h-3 bg-blue-500 rounded-full"></div>
              <h3 className="text-lg font-semibold text-blue-800">早上班Uncle (英文)</h3>
            </div>
            
            {morningMessage ? (
              <div className="space-y-4">
                <div className="bg-white p-4 rounded border text-sm font-mono whitespace-pre-wrap max-h-64 overflow-y-auto">
                  {morningMessage}
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={() => window.open(generateWhatsAppLink(morningMessage, contacts.morningUncle.phone), '_blank')}
                    className="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 transition-colors"
                  >
                    <span>📱</span>
                    发送给早上班Uncle
                  </button>
                  <button
                    onClick={() => copyToClipboard(morningMessage)}
                    className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg transition-colors"
                    title="复制消息"
                  >
                    📋
                  </button>
                </div>
              </div>
            ) : (
              <div className="text-gray-500 text-center py-8">
                今天没有早上班安排
              </div>
            )}
          </div>

          {/* 下午班Uncle通知 */}
          <div className="bg-orange-50 border border-orange-200 rounded-lg p-6">
            <div className="flex items-center gap-2 mb-4">
              <div className="w-3 h-3 bg-orange-500 rounded-full"></div>
              <h3 className="text-lg font-semibold text-orange-800">下午班Uncle (中文)</h3>
            </div>
            
            {afternoonMessage ? (
              <div className="space-y-4">
                <div className="bg-white p-4 rounded border text-sm whitespace-pre-wrap max-h-64 overflow-y-auto">
                  {afternoonMessage}
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={() => window.open(generateWhatsAppLink(afternoonMessage, contacts.afternoonUncle.phone), '_blank')}
                    className="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 transition-colors"
                  >
                    <span>📱</span>
                    发送给下午班Uncle
                  </button>
                  <button
                    onClick={() => copyToClipboard(afternoonMessage)}
                    className="bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-lg transition-colors"
                    title="复制消息"
                  >
                    📋
                  </button>
                </div>
              </div>
            ) : (
              <div className="text-gray-500 text-center py-8">
                今天没有下午班安排
              </div>
            )}
          </div>

          {/* Aunty载送通知 */}
          <div className="bg-purple-50 border border-purple-200 rounded-lg p-6">
            <div className="flex items-center gap-2 mb-4">
              <div className="w-3 h-3 bg-purple-500 rounded-full"></div>
              <h3 className="text-lg font-semibold text-purple-800">Aunty载送提醒</h3>
            </div>
            
            {auntyMessage ? (
              <div className="space-y-4">
                <div className="bg-white p-4 rounded border text-sm whitespace-pre-wrap max-h-64 overflow-y-auto">
                  {auntyMessage}
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={() => window.open(generateWhatsAppLink(auntyMessage), '_blank')}
                    className="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 transition-colors"
                  >
                    <span>📱</span>
                    发送给家长群
                  </button>
                  <button
                    onClick={() => copyToClipboard(auntyMessage)}
                    className="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg transition-colors"
                    title="复制消息"
                  >
                    📋
                  </button>
                </div>
              </div>
            ) : (
              <div className="text-gray-500 text-center py-8">
                今天没有Aunty载送安排
              </div>
            )}
          </div>
        </div>

        {/* 使用说明 */}
        <div className="bg-gray-50 p-6 rounded-lg">
          <h3 className="text-lg font-semibold text-gray-800 mb-3">📖 使用说明</h3>
          <div className="grid md:grid-cols-3 gap-4 text-sm">
            <div className="bg-blue-100 p-3 rounded">
              <h4 className="font-medium text-blue-800 mb-1">🌅 早上班Uncle</h4>
              <p className="text-blue-700">发送英文版上午载送安排，包含所有早上的接送时间和学生名单。</p>
            </div>
            <div className="bg-orange-100 p-3 rounded">
              <h4 className="font-medium text-orange-800 mb-1">🌆 下午班Uncle</h4>
              <p className="text-orange-700">发送中文版下午载送安排，包含下午班和晚上的所有安排。</p>
            </div>
            <div className="bg-purple-100 p-3 rounded">
              <h4 className="font-medium text-purple-800 mb-1">🏠 Aunty载送</h4>
              <p className="text-purple-700">提醒家长自行载送的学生名单和时间，可群发给家长群。</p>
            </div>
          </div>
          
          <div className="mt-4 p-3 bg-yellow-100 rounded border-l-4 border-yellow-400">
            <p className="text-yellow-800 text-sm">
              💡 <strong>小贴士:</strong> 点击"发送给XXX"会直接打开WhatsApp并发送给指定联系人，点击"📋"按钮可复制消息到剪贴板。
              建议每天早上发送给相关人员，确保载送安排顺利进行。
            </p>
          </div>
          
          <div className="mt-3 p-3 bg-blue-100 rounded border-l-4 border-blue-400">
            <p className="text-blue-800 text-sm">
              ⚙️ <strong>联系人设置:</strong> 如需修改Uncle的电话号码，请在代码中更新contacts对象。
              当前设置 - 早上班Uncle: {contacts.morningUncle.phone} | 下午班Uncle: {contacts.afternoonUncle.phone}
            </p>
          </div>
        </div>
      </div>
    );
  };
  const renderReportsView = () => {
    const uncleStudents = [];
    const auntyStudents = [];
    
    // 统计Uncle和Aunty载送的学生
    Object.entries(studentsDatabase).forEach(([grade, students]) => {
      students.forEach(student => {
        if (student.aunty) {
          auntyStudents.push({ ...student, grade });
        } else {
          uncleStudents.push({ ...student, grade });
        }
      });
    });

    return (
      <div className="space-y-6">
        <div className="grid md:grid-cols-2 gap-6">
          <div className="bg-blue-50 p-6 rounded-lg">
            <h3 className="text-xl font-semibold text-blue-800 mb-4 flex items-center gap-2">
              <Car className="w-6 h-6" />
              Uncle载送学生 ({uncleStudents.length}人)
            </h3>
            <div className="space-y-2 max-h-96 overflow-y-auto">
              {uncleStudents.map((student, idx) => (
                <div key={idx} className="bg-white p-3 rounded border flex justify-between items-center">
                  <div>
                    <span className="font-medium">{student.grade} {student.name}</span>
                    {student.school && <span className="text-gray-600 ml-2">({student.school})</span>}
                  </div>
                  {student.phone && <Phone className="w-4 h-4 text-blue-600" />}
                </div>
              ))}
            </div>
          </div>

          <div className="bg-orange-50 p-6 rounded-lg">
            <h3 className="text-xl font-semibold text-orange-800 mb-4 flex items-center gap-2">
              <Users className="w-6 h-6" />
              Aunty载送学生 ({auntyStudents.length}人)
            </h3>
            <div className="space-y-2 max-h-96 overflow-y-auto">
              {auntyStudents.map((student, idx) => (
                <div key={idx} className="bg-white p-3 rounded border flex justify-between items-center">
                  <div>
                    <span className="font-medium">{student.grade} {student.name}</span>
                    {student.school && <span className="text-gray-600 ml-2">({student.school})</span>}
                  </div>
                  {student.address && <MapPin className="w-4 h-4 text-orange-600" />}
                </div>
              ))}
            </div>
          </div>
        </div>

        <div className="bg-gray-50 p-6 rounded-lg">
          <h3 className="text-xl font-semibold text-gray-800 mb-4">每日载送统计</h3>
          <div className="grid md:grid-cols-5 gap-4">
            {daysOfWeek.map((day) => {
              const schedule = weeklySchedule[day.key];
              let totalStudents = 0;
              let auntyCount = 0;
              
              if (schedule) {
                [...(schedule.morning || []), ...(schedule.afternoon || [])].forEach(session => {
                  totalStudents += session.students.length;
                  if (session.auntyStudents) {
                    auntyCount += session.auntyStudents.length;
                  }
                });
              }
              
              return (
                <div key={day.key} className="bg-white p-4 rounded border text-center">
                  <h4 className="font-medium text-gray-800">{day.label}</h4>
                  <div className="mt-2 space-y-1">
                    <div className="text-blue-600 font-semibold">Uncle: {totalStudents}人</div>
                    <div className="text-orange-600 font-semibold">Aunty: {auntyCount}人</div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </div>
    );
  };

  return (
    <div className="max-w-7xl mx-auto p-6 bg-gray-50 min-h-screen">
      <div className="bg-white rounded-lg shadow-lg">
        {/* Header */}
        <div className="bg-gradient-to-r from-blue-600 to-green-600 text-white p-6 rounded-t-lg">
          <h1 className="text-3xl font-bold flex items-center gap-3">
            <Calendar className="w-8 h-8" />
            载送时间表管理系统
          </h1>
          <p className="mt-2 opacity-90">管理每日Uncle和Aunty载送安排</p>
        </div>

        {/* Navigation */}
        <div className="border-b bg-gray-50">
          <div className="flex flex-wrap gap-1 p-4">
            <button
              onClick={() => setViewMode('daily')}
              className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                viewMode === 'daily' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-blue-50'
              }`}
            >
              每日时间表
            </button>
            <button
              onClick={() => setViewMode('weekly')}
              className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                viewMode === 'weekly' ? 'bg-green-600 text-white' : 'bg-white text-gray-700 hover:bg-green-50'
              }`}
            >
              周时间表
            </button>
            <button
              onClick={() => setViewMode('students')}
              className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                viewMode === 'students' ? 'bg-purple-600 text-white' : 'bg-white text-gray-700 hover:bg-purple-50'
              }`}
            >
              学生管理
            </button>
            <button
              onClick={() => setViewMode('reports')}
              className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                viewMode === 'reports' ? 'bg-orange-600 text-white' : 'bg-white text-gray-700 hover:bg-orange-50'
              }`}
            >
              统计报告
            </button>
            <button
              onClick={() => setViewMode('whatsapp')}
              className={`px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${
                viewMode === 'whatsapp' ? 'bg-green-600 text-white' : 'bg-white text-gray-700 hover:bg-green-50'
              }`}
            >
              <MessageCircle className="w-4 h-4" />
              WhatsApp通知
            </button>
          </div>
        </div>

        {/* Content */}
        <div className="p-6">
          {viewMode === 'daily' && (
            <div>
              <div className="flex flex-wrap gap-2 mb-6">
                {daysOfWeek.map((day) => (
                  <button
                    key={day.key}
                    onClick={() => setSelectedDay(day.key)}
                    className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                      selectedDay === day.key 
                        ? 'bg-blue-600 text-white' 
                        : day.key === getTodayKey()
                        ? 'bg-green-100 text-green-800 border-2 border-green-300'
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    {day.label}
                    {day.key === getTodayKey() && (
                      <span className="ml-1 text-xs bg-green-500 text-white px-1 rounded">今天</span>
                    )}
                  </button>
                ))}
              </div>
              
              <div className="bg-blue-50 p-4 rounded-lg mb-6">
                <h2 className="text-xl font-semibold text-blue-800">
                  {daysOfWeek.find(d => d.key === selectedDay)?.label} 载送安排
                </h2>
                <p className="text-blue-600 mt-1">
                  {new Date().toLocaleDateString('zh-CN', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                  })}
                </p>
              </div>
              
              {renderDailySchedule(selectedDay)}
            </div>
          )}

          {viewMode === 'weekly' && (
            <div className="space-y-8">
              <h2 className="text-2xl font-semibold text-gray-800">周载送时间表概览</h2>
              {daysOfWeek.map((day) => (
                <div key={day.key} className="border rounded-lg p-6 bg-white shadow-sm">
                  <h3 className="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                    {day.label} ({day.english})
                    {day.key === getTodayKey() && (
                      <span className="bg-green-500 text-white px-2 py-1 rounded text-sm">今天</span>
                    )}
                  </h3>
                  {renderDailySchedule(day.key)}
                </div>
              ))}
            </div>
          )}

          {viewMode === 'students' && renderStudentsView()}
          {viewMode === 'reports' && renderReportsView()}
          {viewMode === 'whatsapp' && renderWhatsAppView()}
        </div>
      </div>
    </div>
  );
};

export default TransportManagementSystem;
